index=azure sourcetype="azure:aad:audit" 
(operationName="Disable account" OR (operationName="Update user" AND result.accountEnabled=false))
| eval timestamp=strftime(_time, "%Y-%m-%d %H:%M:%S")
| eval targetUserPrincipalName=case(
    isnotnull(targetResources{}.userPrincipalName), targetResources{}.userPrincipalName,
    isnotnull(target.userPrincipalName), target.userPrincipalName,
    1=1, "Unknown"
)
| eval initiatedBy=case(
    isnotnull(initiatedBy.user.userPrincipalName), initiatedBy.user.userPrincipalName,
    isnotnull(initiatedBy.app.displayName), initiatedBy.app.displayName,
    1=1, "System"
)
| stats 
    latest(timestamp) as last_modified,
    values(initiatedBy) as modified_by,
    values(result.accountEnabled) as account_status
    by targetUserPrincipalName
| where account_status="false"
| rename 
    targetUserPrincipalName as "User",
    last_modified as "Last Modified",
    modified_by as "Modified By"
| sort - "Last Modified"