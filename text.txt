function Remove-TableRows($context) {
    $tables = Get-AzStorageTable -Context $context
    $Days = 365
    $Date = (Get-Date).AddDays(-$Days)
    foreach ($table in $tables) {
        Write-Host "Working on table" $table.Name
        $storageTable = Get-AzStorageTable -Name $table.Name -Context $context
        $TableName = $table.Name

        # Generate filter condition based on Timestamp property
        $Filter = [Microsoft.Azure.Cosmos.Table.TableQuery]::GenerateFilterConditionForDate("Timestamp", "lt", $Date)

        # Use a continuation token to process rows in batches
        $ContinuationToken = $null
        $BatchSize = 1000 # Adjust the batch size if needed

        do {
            # Query a batch of entities from the table
            $Query = New-AzTableQuery -Context $context -Filter $Filter -MaxResult $BatchSize
            $Entities = Get-AzTableRow -table $storageTable.CloudTable -customFilter $Filter -ContinuationToken $ContinuationToken

            # Get the continuation token to process the next batch
            $ContinuationToken = $Entities.ContinuationToken

            # Get the total number of entities in the batch
            $BatchCount = $Entities.Count
            Write-Host "$BatchCount entities retrieved from $TableName"

            # Loop through the entities and delete them one by one
            foreach ($Entity in $Entities) {
                Remove-AzTableRow -table $storageTable.CloudTable -entity $Entity
            }

            Write-Host "Deleted $BatchCount entities from $TableName"
        } while ($ContinuationToken -ne $null) # Continue until all rows are processed

        Write-Host "All entities older than $Days days have been deleted from $TableName"
    }
}