# Reference the existing Event Hub Namespace and Event Hub
data "azurerm_eventhub_namespace" "existing" {
  name                = "existing-eventhub-namespace"
  resource_group_name = "existing-resource-group"
}

data "azurerm_eventhub" "existing" {
  name                = "existing-eventhub-name"
  namespace_name      = data.azurerm_eventhub_namespace.existing.name
  resource_group_name = data.azurerm_eventhub_namespace.existing.resource_group_name
}

data "azurerm_eventhub_authorization_rule" "existing" {
  name                = "RootManageSharedAccessKey"
  namespace_name      = data.azurerm_eventhub_namespace.existing.name
  eventhub_name       = data.azurerm_eventhub.existing.name
  resource_group_name = data.azurerm_eventhub_namespace.existing.resource_group_name
}


# Subscription Activity Log Diagnostic Setting
resource "azurerm_monitor_diagnostic_setting" "activity_logs" {
  name               = "send-activity-logs-to-existing-eventhub"
  target_resource_id = "/subscriptions/${data.azurerm_subscription.current.subscription_id}/providers/microsoft.insights/eventtypes/management"
  
  eventhub_authorization_rule_id = data.azurerm_eventhub_authorization_rule.existing.id
  eventhub_name                  = data.azurerm_eventhub.existing.name

  logs {
    category = "Administrative"
    enabled  = true
  }

  logs {
    category = "ServiceHealth"
    enabled  = true
  }

  logs {
    category = "Security"
    enabled  = true
  }

  logs {
    category = "Alert"
    enabled  = true
  }

  logs {
    category = "Recommendation"
    enabled  = true
  }
}

# Get the current subscription details
data "azurerm_subscription" "current" {}





